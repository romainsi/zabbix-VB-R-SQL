<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>6.0</version>
    <date>2022-06-28T09:59:09Z</date>
    <groups>
        <group>
            <uuid>a571c0d144b14fd4a87a9d9b2aa9fcd6</uuid>
            <name>Templates/Applications</name>
        </group>
    </groups>
    <templates>
        <template>
            <uuid>6f3da5aef0d44e2692bfb3949628da5e</uuid>
            <template>Veeam Backup And Replication</template>
            <name>Veeam Backup And Replication</name>
            <description>Version: 2.9
Monitor Veeam Backup and Replication job and repository information
It uses SQL queries to the Veeam database to obtain the information
To use the template:
1. Install the Zabbix agent or Zabbix agent 2 on your host.
2. Connect to the veeam sql server, adjust protocols for VEEAMSQL in "Sql Server Configuration Manager" to permit connection using TCP/IP
3. Create User/Pass with reader rights, permit to connect with local user in sql settings and specify the default database, using SQL Server Management Studio.
   Alternatively you can use the following sql commands, using sqlcmd.exe:
`USE [VeeamBackup]`  
`CREATE LOGIN [zabbixveeam] WITH PASSWORD = N'CHANGEME', CHECK_POLICY = OFF, CHECK_EXPIRATION = OFF;`  
`CREATE USER [zabbixveeam] FOR LOGIN [zabbixveeam];`  
`EXEC sp_addrolemember 'db_datareader', 'zabbixveeam';`  
`GO`  
4. In script, ajust variables on lines 73-78 to match your configuration
5. Copy `zabbix_vbr_job.ps1` in the directory : `C:\Program Files\Zabbix Agent 2\scripts\` (create folder if not exist)
6. Add `UserParameter=veeam.info[*],powershell -NoProfile -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent 2\scripts\zabbix_vbr_job.ps1" "$1"` in zabbix_agent2.conf  
7. Associate the template to the host with Veeam Backup and Replication installed

Created by:
Romainsi https://github.com/romainsi

Contributions:
aholiveira https://github.com/aholiveira
xtonousou https://github.com/xtonousou</description>
            <groups>
                <group>
                    <name>Templates/Applications</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>8980fabd75684014aa4de0bd63d185c5</uuid>
                    <name>Veeam Job Info</name>
                    <key>veeam.info[JobsInfo]</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>Master Items</value>
                        </tag>
                        <tag>
                            <tag>Application</tag>
                            <value>Veeam Backup and Replication</value>
                        </tag>
                        <tag>
                            <tag>Application</tag>
                            <value>Veeam Jobs</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>938d938bfb064a8bbc9642ab8825e527</uuid>
                            <expression>nodata(/Veeam Backup And Replication/veeam.info[JobsInfo],7200s)=1</expression>
                            <name>No data on Jobs</name>
                            <priority>AVERAGE</priority>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                            </tags>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>b4f0d0f76bfc45dfad2233b693788d10</uuid>
                    <name>Veeam Repository Info</name>
                    <key>veeam.info[RepoInfo]</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>Master Items</value>
                        </tag>
                        <tag>
                            <tag>Application</tag>
                            <value>Veeam Backup and Replication</value>
                        </tag>
                        <tag>
                            <tag>Application</tag>
                            <value>Veeam Repository</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>671f4be1ba9d41a39aec048031467920</uuid>
                            <expression>nodata(/Veeam Backup And Replication/veeam.info[RepoInfo],7200s)=1</expression>
                            <name>No data in RepoInfo</name>
                            <priority>AVERAGE</priority>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                            </tags>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>57abe94db85d49009745ab2d163fa59b</uuid>
                    <name>Nombre Total de backup Veeam</name>
                    <key>veeam.info[TotalJob]</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>Master Items</value>
                        </tag>
                        <tag>
                            <tag>Application</tag>
                            <value>Veeam Backup and Replication</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>72f6223c337e4c2b88a2d7ac703db143</uuid>
                    <name>Veeam Jobs Discovery</name>
                    <type>DEPENDENT</type>
                    <key>veeam.Discovery.Jobs</key>
                    <delay>0</delay>
                    <lifetime>1h</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>0496e3edd6a94181a4a6a5571a150ab8</uuid>
                            <name>Durée de la dernière tâche {#JOBNAME}</name>
                            <type>CALCULATED</type>
                            <key>veeam.Jobs.Duration['{#JOBTYPEID}','{#JOBID}']</key>
                            <delay>5m</delay>
                            <units>s</units>
                            <params>last(//veeam.Jobs.LastEnd['{#JOBTYPEID}','{#JOBID}'])-last(//veeam.Jobs.LastStart['{#JOBTYPEID}','{#JOBID}'])</params>
                            <preprocessing>
                                <step>
                                    <type>CHECK_NOT_SUPPORTED</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>f9ee55a362db407b89d0d8094dacd381</uuid>
                            <name>Dernière fin de tâche {#JOBNAME}</name>
                            <type>DEPENDENT</type>
                            <key>veeam.Jobs.LastEnd['{#JOBTYPEID}','{#JOBID}']</key>
                            <delay>0</delay>
                            <units>unixtime</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.JOBID=='{#JOBID}')].JOBEND.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>veeam.info[JobsInfo]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>b7a30412a17b4f5f8618deb8812494a2</uuid>
                            <name>Dernier lancement tâche {#JOBNAME}</name>
                            <type>DEPENDENT</type>
                            <key>veeam.Jobs.LastStart['{#JOBTYPEID}','{#JOBID}']</key>
                            <delay>0</delay>
                            <units>unixtime</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.JOBID=='{#JOBID}')].JOBSTART.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>veeam.info[JobsInfo]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>0ce7808f0cbd4f28884595ecfc6a534c</uuid>
                            <name>Progression Backup {#JOBTYPENAME}: {#JOBNAME}</name>
                            <type>DEPENDENT</type>
                            <key>veeam.Jobs.Progress['{#JOBTYPEID}','{#JOBID}']</key>
                            <delay>0</delay>
                            <units>%</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.JOBID=='{#JOBID}')].JOBPROGRESS.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>veeam.info[JobsInfo]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>d773dc4645ce4f0d94fac0f6f1ac3e5d</uuid>
                            <name>Dernière raison {#JOBNAME}</name>
                            <type>DEPENDENT</type>
                            <key>veeam.Jobs.Reason['{#JOBTYPEID}','{#JOBID}']</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.JOBID=='{#JOBID}')].JOBREASON.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>veeam.info[JobsInfo]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>befe5267925d49f5a82fab79c54af57c</uuid>
                            <name>Résultat backup {#JOBTYPENAME}: {#JOBNAME}</name>
                            <type>DEPENDENT</type>
                            <key>veeam.Jobs.Result['{#JOBTYPEID}','{#JOBID}']</key>
                            <delay>0</delay>
                            <value_type>FLOAT</value_type>
                            <valuemap>
                                <name>VbrJsonResult</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.JOBID=='{#JOBID}')].JOBRESULT.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>veeam.info[JobsInfo]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>0742ac00da44467c9924f440186c5e56</uuid>
                            <name>Is Retry {#JOBNAME}</name>
                            <type>DEPENDENT</type>
                            <key>veeam.Jobs.Retry['{#JOBTYPEID}','{#JOBID}']</key>
                            <delay>0</delay>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.JOBID=='{#JOBID}')].JOBRETRY.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>veeam.info[JobsInfo]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>2a3bc3ccbd81458e98447c49e77303c1</uuid>
                            <expression>last(/Veeam Backup And Replication/veeam.Jobs.Result['{#JOBTYPEID}','{#JOBID}'])=2 and last(/Veeam Backup And Replication/veeam.Jobs.Retry['{#JOBTYPEID}','{#JOBID}'])=0 and length(last(/Veeam Backup And Replication/veeam.Jobs.Reason['{#JOBTYPEID}','{#JOBID}']))>0</expression>
                            <name>Backup {#JOBTYPENAME} {#JOBNAME} Erreur</name>
                            <opdata>{ITEM.LASTVALUE3}</opdata>
                            <priority>HIGH</priority>
                            <description>{#JOBREASON}</description>
                            <dependencies>
                                <dependency>
                                    <name>Backup {#JOBTYPENAME} {#JOBNAME} Erreur (With Retry)</name>
                                    <expression>last(/Veeam Backup And Replication/veeam.Jobs.Result['{#JOBTYPEID}','{#JOBID}'])=2 and last(/Veeam Backup And Replication/veeam.Jobs.Retry['{#JOBTYPEID}','{#JOBID}'])=1 and length(last(/Veeam Backup And Replication/veeam.Jobs.Reason['{#JOBTYPEID}','{#JOBID}']))>0</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>c8c1be6d035d441ebc9669c1e38d632b</uuid>
                            <expression>last(/Veeam Backup And Replication/veeam.Jobs.Result['{#JOBTYPEID}','{#JOBID}'])=2 and last(/Veeam Backup And Replication/veeam.Jobs.Retry['{#JOBTYPEID}','{#JOBID}'])=1 and length(last(/Veeam Backup And Replication/veeam.Jobs.Reason['{#JOBTYPEID}','{#JOBID}']))>0</expression>
                            <name>Backup {#JOBTYPENAME} {#JOBNAME} Erreur (With Retry)</name>
                            <opdata>{ITEM.LASTVALUE3}</opdata>
                            <priority>HIGH</priority>
                            <description>{#JOBREASON}</description>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>e09b65c222a64def80785e061f38affa</uuid>
                            <expression>last(/Veeam Backup And Replication/veeam.Jobs.Result['{#JOBTYPEID}','{#JOBID}'])&lt;0 and (now()-avg(/Veeam Backup And Replication/veeam.Jobs.LastStart['{#JOBTYPEID}','{#JOBID}'],2m))&gt;{$VEEAM_JOB_HOURS_WARN:&quot;{#JOBNAME}&quot;}*3600</expression>
                            <name>Backup {#JOBTYPENAME} {#JOBNAME} Progression &gt; {$VEEAM_JOB_HOURS_WARN:&quot;{#JOBNAME}&quot;}h</name>
                            <opdata>LastStart: {ITEM.LASTVALUE2} Progress: {ITEM.LASTVALUE1}</opdata>
                            <priority>HIGH</priority>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>06ef57742fac4fbdb906a223b75f995b</uuid>
                            <expression>last(/Veeam Backup And Replication/veeam.Jobs.Result['{#JOBTYPEID}','{#JOBID}'])=1 and last(/Veeam Backup And Replication/veeam.Jobs.Retry['{#JOBTYPEID}','{#JOBID}'])=0 and length(last(/Veeam Backup And Replication/veeam.Jobs.Reason['{#JOBTYPEID}','{#JOBID}']))>0</expression>
                            <name>Backup {#JOBTYPENAME} {#JOBNAME} terminé avec Avertissement</name>
                            <opdata>{ITEM.LASTVALUE3}</opdata>
                            <priority>AVERAGE</priority>
                            <description>{#JOBREASON}</description>
                            <dependencies>
                                <dependency>
                                    <name>Backup {#JOBTYPENAME} {#JOBNAME} terminé avec Avertissement (With Retry)</name>
                                    <expression>last(/Veeam Backup And Replication/veeam.Jobs.Result['{#JOBTYPEID}','{#JOBID}'])=1 and last(/Veeam Backup And Replication/veeam.Jobs.Retry['{#JOBTYPEID}','{#JOBID}'])=1 and length(last(/Veeam Backup And Replication/veeam.Jobs.Reason['{#JOBTYPEID}','{#JOBID}']))>0</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>0bd3bd512a9342d6b69ea1099bc35cba</uuid>
                            <expression>last(/Veeam Backup And Replication/veeam.Jobs.Result['{#JOBTYPEID}','{#JOBID}'])=1 and last(/Veeam Backup And Replication/veeam.Jobs.Retry['{#JOBTYPEID}','{#JOBID}'])=1 and length(last(/Veeam Backup And Replication/veeam.Jobs.Reason['{#JOBTYPEID}','{#JOBID}']))>0</expression>
                            <name>Backup {#JOBTYPENAME} {#JOBNAME} terminé avec Avertissement (With Retry)</name>
                            <opdata>{ITEM.LASTVALUE3}</opdata>
                            <priority>AVERAGE</priority>
                            <description>{#JOBREASON}</description>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Backup Job</tag>
                                    <value>{#JOBNAME}</value>
                                </tag>
                                <tag>
                                    <tag>Backup Type</tag>
                                    <value>{#JOBTYPENAME}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>a784c019181e403396bb8ad933739daf</uuid>
                            <name>Durée {#JOBNAME}</name>
                            <graph_items>
                                <graph_item>
                                    <drawtype>GRADIENT_LINE</drawtype>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Veeam Backup And Replication</host>
                                        <key>veeam.Jobs.Duration['{#JOBTYPEID}','{#JOBID}']</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>veeam.info[JobsInfo]</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#JOBID}</lld_macro>
                            <path>$.JOBID</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#JOBNAME}</lld_macro>
                            <path>$.JOBNAME</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#JOBREASON}</lld_macro>
                            <path>$.JOBREASON</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#JOBTYPEID}</lld_macro>
                            <path>$.JOBTYPEID</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#JOBTYPENAME}</lld_macro>
                            <path>$.JOBTYPENAME</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                </discovery_rule>
                <discovery_rule>
                    <uuid>9d3543413aeb4bc582b44cf9d03b0787</uuid>
                    <name>Veeam Repository</name>
                    <type>DEPENDENT</type>
                    <key>Veeam.Discovery.Repo</key>
                    <delay>0</delay>
                    <lifetime>7d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>f7c95c54aadc4a53862a4de689b42cf9</uuid>
                            <name>Espace Total {#REPONAME}</name>
                            <type>DEPENDENT</type>
                            <key>veeam.RepoInfo.Capacity['{#REPONAME}']</key>
                            <delay>0</delay>
                            <history>30d</history>
                            <trends>90d</trends>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.REPONAME=='{#REPONAME}')].REPOCAPACITY.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>veeam.info[RepoInfo]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Repository</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>288ba9353a394ef3adb0076483b75ea4</uuid>
                            <name>Espace restant {#REPONAME}</name>
                            <type>DEPENDENT</type>
                            <key>veeam.RepoInfo.FreeSpace['{#REPONAME}']</key>
                            <delay>0</delay>
                            <history>30d</history>
                            <trends>90d</trends>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.REPONAME=='{#REPONAME}')].REPOFREE.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>veeam.info[RepoInfo]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Repository</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>6a38e3e0544d4ef083ce36a8cc6a5862</uuid>
                            <name>{#REPONAME} pas à jour</name>
                            <type>DEPENDENT</type>
                            <key>veeam.RepoInfo.OutOfDate['{#REPONAME}']</key>
                            <delay>0</delay>
                            <history>30d</history>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.REPONAME=='{#REPONAME}')].REPOOUTOFDATE.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>veeam.info[RepoInfo]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Repository</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>c45376c7d61f47e4b7c30482568b1d76</uuid>
                                    <expression>last(/Veeam Backup And Replication/veeam.RepoInfo.OutOfDate['{#REPONAME}'])=1</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>last(/Veeam Backup And Replication/veeam.RepoInfo.OutOfDate['{#REPONAME}'])=0</recovery_expression>
                                    <name>Repository {#REPONAME} l'information n'est pas à jour</name>
                                    <priority>HIGH</priority>
                                    <tags>
                                        <tag>
                                            <tag>Application</tag>
                                            <value>Veeam Backup and Replication</value>
                                        </tag>
                                        <tag>
                                            <tag>Application</tag>
                                            <value>Veeam Repository</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>351fcc7e69b1472b8a09a02470082e13</uuid>
                            <name>Pourcentage d'espace libre sur {#REPONAME}</name>
                            <type>CALCULATED</type>
                            <key>veeam.RepoInfo.PercentFree['{#REPONAME}']</key>
                            <delay>10m</delay>
                            <value_type>FLOAT</value_type>
                            <units>%</units>
                            <params>last(//veeam.RepoInfo.FreeSpace['{#REPONAME}'])/last(//veeam.RepoInfo.Capacity['{#REPONAME}'])*100</params>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Backup and Replication</value>
                                </tag>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Veeam Repository</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>6788ff77c1d34b34b4eeec6805c5d98b</uuid>
                                    <expression>last(/Veeam Backup And Replication/veeam.RepoInfo.PercentFree['{#REPONAME}'])&lt;{$VEEAM_REPO_FREE_WARN:&quot;{#REPONAME}&quot;}</expression>
                                    <name>Moins de {$VEEAM_REPO_FREE_WARN:"{#REPONAME}"}% restant sur le repository {#REPONAME}</name>
                                    <opdata>Current value: {ITEM.LASTVALUE1}</opdata>
                                    <priority>HIGH</priority>
                                    <tags>
                                        <tag>
                                            <tag>Application</tag>
                                            <value>Veeam Backup and Replication</value>
                                        </tag>
                                        <tag>
                                            <tag>Application</tag>
                                            <value>Veeam Repository</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>30818fc98c734dc18c88d91c0f0c829a</uuid>
                            <name>Espace restant repository {#REPONAME}</name>
                            <graph_items>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Veeam Backup And Replication</host>
                                        <key>veeam.RepoInfo.FreeSpace['{#REPONAME}']</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <uuid>36f1adb2dd3c46648799202f4cae3e14</uuid>
                            <name>Pourcentage d'espace libre {#REPONAME}</name>
                            <graph_items>
                                <graph_item>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Veeam Backup And Replication</host>
                                        <key>veeam.RepoInfo.PercentFree['{#REPONAME}']</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>veeam.info[RepoInfo]</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#REPONAME}</lld_macro>
                            <path>$.REPONAME</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                </discovery_rule>
            </discovery_rules>
            <tags>
                <tag>
                    <tag>class</tag>
                    <value>application</value>
                </tag>
                <tag>
                    <tag>target</tag>
                    <value>veeam-backup-and-replication</value>
                </tag>
            </tags>
            <macros>
                <macro>
                    <macro>{$VEEAM_JOB_HOURS_WARN}</macro>
                    <value>8</value>
                </macro>
                <macro>
                    <macro>{$VEEAM_REPO_FREE_WARN}</macro>
                    <value>20</value>
                </macro>
            </macros>
            <valuemaps>
                <valuemap>
                    <uuid>cf1d0998a2644d90a948725c37df5fbd</uuid>
                    <name>VbrJsonResult</name>
                    <mappings>
                        <mapping>
                            <value>-1</value>
                            <newvalue>InProgress</newvalue>
                        </mapping>
                        <mapping>
                            <value>0</value>
                            <newvalue>Success</newvalue>
                        </mapping>
                        <mapping>
                            <value>1</value>
                            <newvalue>Warning</newvalue>
                        </mapping>
                        <mapping>
                            <value>2</value>
                            <newvalue>Error</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
                <valuemap>
                    <uuid>38e521dc4ad54ac18741ed55765f4f84</uuid>
                    <name>veeamTypeMap</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>Job</newvalue>
                        </mapping>
                        <mapping>
                            <value>1</value>
                            <newvalue>Replication</newvalue>
                        </mapping>
                        <mapping>
                            <value>2</value>
                            <newvalue>File</newvalue>
                        </mapping>
                        <mapping>
                            <value>28</value>
                            <newvalue>Tape</newvalue>
                        </mapping>
                        <mapping>
                            <value>51</value>
                            <newvalue>Sync</newvalue>
                        </mapping>
                        <mapping>
                            <value>63</value>
                            <newvalue>Copy</newvalue>
                        </mapping>
                        <mapping>
                            <value>4030</value>
                            <newvalue>RMAN</newvalue>
                        </mapping>
                        <mapping>
                            <value>12002</value>
                            <newvalue>AgentBackupPolicy</newvalue>
                        </mapping>
                        <mapping>
                            <value>12003</value>
                            <newvalue>AgentBackupJob</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
            </valuemaps>
        </template>
    </templates>
</zabbix_export>
